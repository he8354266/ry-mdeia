(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0dd105"],{8090:function(e,i,t){"use strict";t.r(i);var l=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("div",{staticClass:"app-container"},[t("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,size:"small",inline:!0,"label-width":"68px"}},[t("el-form-item",{attrs:{label:"编号",prop:"number"}},[t("el-input",{attrs:{placeholder:"请输入编号",clearable:""},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.handleQuery(i)}},model:{value:e.queryParams.number,callback:function(i){e.$set(e.queryParams,"number",i)},expression:"queryParams.number"}})],1),t("el-form-item",{attrs:{label:"昵称",prop:"nickName"}},[t("el-input",{attrs:{placeholder:"请输入昵称",clearable:""},nativeOn:{keyup:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.handleQuery(i)}},model:{value:e.queryParams.nickName,callback:function(i){e.$set(e.queryParams,"nickName",i)},expression:"queryParams.nickName"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),t("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),t("el-row",{staticClass:"mb8",attrs:{gutter:10}},[t("el-col",{attrs:{span:1.5}},[t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["waterfall:info:add"],expression:"['waterfall:info:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:e.handleAdd}},[e._v("新增")])],1),t("el-col",{attrs:{span:1.5}},[t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["waterfall:info:remove"],expression:"['waterfall:info:remove']"}],attrs:{type:"danger",plain:"",icon:"el-icon-delete",size:"mini",disabled:e.disableMultiple},on:{click:e.handleDeletes}},[e._v("删除")])],1),t("right-toolbar",{attrs:{showSearch:e.showSearch},on:{"update:showSearch":function(i){e.showSearch=i},"update:show-search":function(i){e.showSearch=i},queryTable:e.getList}})],1),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.infoList},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t("el-table-column",{attrs:{label:"编号",align:"center",prop:"number"}}),t("el-table-column",{attrs:{label:"昵称",align:"center",prop:"nickName"}}),t("el-table-column",{attrs:{label:"封面图片",align:"center",prop:"video"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{staticStyle:{width:"100%",display:"flex","justify-content":"center"}},[i.row.titleImg?t("img",{staticStyle:{display:"block",width:"auto",height:"80px"},attrs:{src:i.row.titleImg}}):e._e()])]}}])}),t("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["waterfall:info:edit"],expression:"['waterfall:info:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(t){return e.handleUpdate(i.row)}}},[e._v("修改")]),t("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["waterfall:info:remove"],expression:"['waterfall:info:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.handleDeletes(i.row)}}},[e._v("删除")])]}}])})],1),t("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(i){return e.$set(e.queryParams,"pageNum",i)},"update:limit":function(i){return e.$set(e.queryParams,"pageSize",i)},pagination:e.getList}}),t("el-dialog",{attrs:{title:e.title,visible:e.open,width:"900px","append-to-body":""},on:{"update:visible":function(i){e.open=i}}},[t("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"编号",prop:"number"}},[t("el-input",{attrs:{placeholder:"请输入编号"},model:{value:e.form.number,callback:function(i){e.$set(e.form,"number",i)},expression:"form.number"}})],1)],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"昵称",prop:"nickName"}},[t("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.form.nickName,callback:function(i){e.$set(e.form,"nickName",i)},expression:"form.nickName"}})],1)],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"封面图片",prop:"titleImg"}},[t("div",{staticClass:"component-upload-image"},[t("el-upload",{ref:"imageUpload",class:{hide:e.imgUploadList.length>=1},attrs:{action:e.uploadImgUrl,"list-type":"picture-card","on-success":e.imgHandleUploadSuccess,"before-upload":e.imgHandleBeforeUpload,limit:1,"on-error":e.imgHandleUploadError,"on-exceed":e.imgHandleExceed,"on-remove":e.imgUploadRemove,"show-file-list":!0,headers:e.headers,"file-list":e.imgUploadList,"on-preview":e.handlePictureCardPreview}},[t("i",{staticClass:"el-icon-plus"})]),e.showTip?t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" 请上传 "),e.imgFileSize?[e._v(" 大小不超过 "),t("b",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.imgFileSize)+"MB")])]:e._e(),e.imgFileType?[e._v(" 格式为 "),t("b",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.imgFileType.join("/")))])]:e._e(),e._v(" 的文件 ")],2):e._e(),t("el-dialog",{attrs:{visible:e.dialogVisible,title:"预览",width:"800","append-to-body":""},on:{"update:visible":function(i){e.dialogVisible=i}}},[t("img",{staticStyle:{display:"block","max-width":"100%",margin:"0 auto"},attrs:{src:e.dialogImageUrl}})])],1)])],1),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"详情图片",prop:"imgList"}},[t("div",{staticClass:"component-upload-image"},[t("el-upload",{ref:"imgUpload",attrs:{action:e.uploadImgUrl,"list-type":"picture-card","on-success":e.imgDetailHandleUploadSuccess,"before-upload":e.imgHandleBeforeUpload,"on-error":e.imgHandleUploadError,"on-exceed":e.imgHandleExceed,"on-remove":e.imgDetailRemove,"show-file-list":!0,headers:e.headers,"file-list":e.imgDetailFileList,"on-preview":e.handleDetailPictureCardPreview}},[t("i",{staticClass:"el-icon-plus"})]),e.showTip?t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" 请上传 "),e.imgFileSize?[e._v(" 大小不超过 "),t("b",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.imgFileSize)+"MB")])]:e._e(),e.imgFileType?[e._v(" 格式为 "),t("b",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.imgFileType.join("/")))])]:e._e(),e._v(" 的文件 ")],2):e._e(),t("el-dialog",{attrs:{visible:e.dialogDetailVisible,title:"预览",width:"800","append-to-body":""},on:{"update:visible":function(i){e.dialogDetailVisible=i}}},[t("img",{staticStyle:{display:"block","max-width":"100%",margin:"0 auto"},attrs:{src:e.dialogDetailImageUrl}})])],1)])],1)],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"详情视频",prop:"videoList"}},[t("div",{staticClass:"upload-file"},[t("el-upload",{ref:"fileUpload",staticClass:"upload-file-uploader",attrs:{action:e.uploadFileUrl,"before-upload":e.handleBeforeUpload,"file-list":e.fileList,"on-error":e.handleUploadError,"on-exceed":e.handleExceed,"on-success":e.handleUploadSuccess,"show-file-list":!1,headers:e.headers}},[t("el-button",{attrs:{size:"mini",type:"primary"}},[e._v("选取视频")]),e.showTip?t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" 请上传 "),e.fileSize?[e._v(" 大小不超过 "),t("b",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.fileSize)+"MB")])]:e._e(),e.fileType?[e._v(" 格式为 "),t("b",{staticStyle:{color:"#f56c6c"}},[e._v(e._s(e.fileType.join("/")))])]:e._e(),e._v(" 的文件 ")],2):e._e()],1),t("transition-group",{staticClass:"upload-file-list el-upload-list el-upload-list--text",attrs:{name:"el-fade-in-linear",tag:"ul"}},e._l(e.fileList,(function(i,l){return t("li",{key:i.url,staticClass:"el-upload-list__item ele-upload-list__item-content"},[t("el-link",{attrs:{href:""+e.baseUrl+i.url,underline:!1,target:"_blank"}},[t("span",{staticClass:"el-icon-document"},[e._v(" "+e._s(e.getFileName(i.name))+" ")])]),t("div",{staticClass:"ele-upload-list__item-content-action"},[t("el-link",{attrs:{underline:!1,type:"danger"},on:{click:function(t){return e.handleDelete(i)}}},[e._v("删除")])],1)],1)})),0)],1)])],1)],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),t("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1)],1)},a=[],r=t("5530"),n=t("ade3"),s=(t("99af"),t("4de4"),t("c740"),t("a15b"),t("d81d"),t("14d9"),t("fb6a"),t("a434"),t("b0c0"),t("e9c4"),t("a9e3"),t("b64b"),t("d3b7"),t("b775"));function o(e){return Object(s["a"])({url:"/waterfall/info/list",method:"get",params:e})}function d(e){return Object(s["a"])({url:"/waterfall/info/"+e,method:"get"})}function m(e){return Object(s["a"])({url:"/waterfall/info",method:"post",data:e})}function c(e){return Object(s["a"])({url:"/waterfall/info",method:"put",data:e})}function u(e){return Object(s["a"])({url:"/waterfall/info/"+e,method:"delete"})}function p(e){return Object(s["a"])({url:"/waterfall/info/delmediaManager",method:"get",params:{id:e}})}var f=t("5f87"),h={name:"Info",props:{value:[String,Object,Array],limit:{type:Number,default:1},fileSize:{type:Number,default:600},fileType:{type:Array,default:function(){return["mp4","avi","rmvb","wmv"]}},isShowTip:{type:Boolean,default:!0},imgFileSize:{type:Number,default:20},imgFileType:{type:Array,default:function(){return["png","jpg","jpeg"]}}},data:function(){return Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])({loading:!0,ids:[],single:!0,multiple:!0,disableMultiple:!1,showSearch:!0,total:0,infoList:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:10,number:null,nickName:null},form:{id:"",number:"",nickName:"",titleImg:"",imgList:[],videoList:[]},rules:{number:[{required:!0,message:"请输入内容",trigger:"blur"}],nickName:[{required:!0,message:"请输入内容",trigger:"blur"}],titleImg:[{required:!0,message:"请上传封面",trigger:"change"}],videoList:[{required:!0,message:"请上传视频",type:"array",trigger:"change"}],imgList:[{required:!0,message:"请上传图片",type:"array",trigger:"change"}]},number:0,uploadList:[],imgList:[],baseUrl:"/media-api",uploadFileUrl:"/media-api/common/upload",headers:{Authorization:"Bearer "+Object(f["a"])()},fileList:[],imgNumber:0,imgUploadList:[],dialogImageUrl:"",dialogVisible:!1,hideUpload:!1,uploadImgUrl:"/media-api/common/upload"},"headers",{Authorization:"Bearer "+Object(f["a"])()}),"imgDetailFileList",[]),"dialogDetailImageUrl",""),"dialogDetailVisible",!1)},watch:{value:{handler:function(e){if(!e)return this.fileList=[],[];var i=1,t=Array.isArray(e)?e:this.value.split(",");this.fileList=t.map((function(e){return"string"===typeof e&&(e={name:e,url:e}),e.uid=e.uid||(new Date).getTime()+i++,e}))},deep:!0,immediate:!0}},computed:{showTip:function(){return this.isShowTip&&(this.fileType||this.fileSize)}},created:function(){this.getList()},methods:{handleChange:function(e){var i=this.dict.type.db_driver.filter((function(i){return i.value===e}))[0];this.form.dbType=i.label},getList:function(){var e=this;this.loading=!0,o(this.queryParams).then((function(i){e.infoList=i.rows,e.total=i.total,e.loading=!1}))},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={id:"",number:"",nickName:"",titleImg:"",imgList:[],videoList:[]},this.fileList=[],this.imgUploadList=[],this.imgDetailFileList=[],this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return{id:e.id,number:e.number}})),this.single=1!==e.length,this.disableMultiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="添加详情信息"},handleUpdate:function(e){var i=this;this.reset();var t=e.id;d(t).then((function(e){i.form=e.data,i.fileList=i.form.videoList.map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{url:e.video,name:e.video})})),i.imgUploadList=i.form.titleImg?[{url:i.form.titleImg,name:i.form.titleImg}]:[],i.imgDetailFileList=i.form.imgList.map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{url:e.img,name:e.img})})),i.open=!0,i.title="修改详情信息"}))},submitForm:function(){var e=this;this.form.titleImg=this.imgUploadList.length?this.imgUploadList[0].url:"",this.form.imgList=this.imgDetailFileList.length?this.imgDetailFileList.map((function(i){var t=Object(r["a"])(Object(r["a"])({},i),{},{img:i.url});return e.form.id&&(t.waterfallId=e.form.id),delete t.video,t})):"",this.form.videoList=this.fileList.length?this.fileList.map((function(i){var t=Object(r["a"])(Object(r["a"])({},i),{},{video:i.url});return e.form.id&&(t.waterfallId=e.form.id),delete t.img,t})):"",this.$refs["form"].validate((function(i){if(i){var t=JSON.parse(JSON.stringify(e.form));e.form.id?c(t).then((function(i){e.$modal.msgSuccess("修改成功"),e.open=!1,e.getList()})):m(t).then((function(i){e.$modal.msgSuccess("新增成功"),e.open=!1,e.getList()}))}}))},handleDeletes:function(e){var i=this;console.log(11);var t=e.id||this.ids.map((function(e){return e.id}));this.$modal.confirm('是否确认删除编号为"'+(this.ids.length?this.ids.map((function(e){return e.number})).join():e.number)+'"的数据项？').then((function(){return u(t)})).then((function(){i.getList(),i.$modal.msgSuccess("删除成功")})).catch((function(){}))},handleExport:function(){this.download("waterfall/info/export",Object(r["a"])({},this.queryParams),"info_".concat((new Date).getTime(),".xlsx"))},handleBeforeUpload:function(e){if(this.fileType){var i=e.name.split("."),t=i[i.length-1],l=this.fileType.indexOf(t)>=0;if(!l)return this.$modal.msgError("文件格式不正确, 请上传".concat(this.fileType.join("/"),"格式文件!")),!1}if(this.fileSize){var a=e.size/1024/1024<this.fileSize;if(!a)return this.$modal.msgError("上传文件大小不能超过 ".concat(this.fileSize," MB!")),!1}return this.$modal.loading("正在上传文件，请稍候..."),this.number++,!0},handleExceed:function(){this.$modal.msgError("上传文件数量不能超过 ".concat(this.limit," 个!"))},handleUploadError:function(e){this.$modal.msgError("上传文件失败，请重试"),this.$modal.closeLoading()},handleUploadSuccess:function(e,i){200===e.code?(this.fileList.push({name:e.newFileName,url:e.url}),console.log(this.fileList),this.$modal.closeLoading()):(this.number--,this.$modal.closeLoading(),this.$modal.msgError(e.msg),this.$refs.fileUpload.handleRemove(i))},handleDelete:function(e){var i=this,t=this.fileList.findIndex((function(i){return i.url===e.url}));-1!=t&&(e.id?p(e.id).then((function(e){200===e.code&&i.fileList.splice(t,1)})):this.fileList.splice(t,1))},uploadedSuccessfully:function(){this.number>0&&this.uploadList.length===this.number&&(this.fileList=this.fileList.concat(this.uploadList),this.uploadList=[],this.number=0,this.$emit("input",this.listToString(this.fileList)),this.$modal.closeLoading())},getFileName:function(e){return e.lastIndexOf("/")>-1?e.slice(e.lastIndexOf("/")+1):e},listToString:function(e,i){var t="";for(var l in i=i||",",e)t+=e[l].url+i;return""!=t?t.substr(0,t.length-1):""},imgHandleBeforeUpload:function(e){var i=!1;if(this.imgFileType.length){var t="";e.name.lastIndexOf(".")>-1&&(t=e.name.slice(e.name.lastIndexOf(".")+1)),i=this.imgFileType.some((function(i){return e.type.indexOf(i)>-1||!!(t&&t.indexOf(i)>-1)}))}else i=e.type.indexOf("image")>-1;if(!i)return this.$modal.msgError("文件格式不正确, 请上传".concat(this.imgFileType.join("/"),"图片格式文件!")),!1;if(this.imgFileSize){var l=e.size/1024/1024<this.imgFileSize;if(!l)return this.$modal.msgError("上传头像图片大小不能超过 ".concat(this.imgFileSize," MB!")),!1}this.$modal.loading("正在上传图片，请稍候..."),this.number++},imgUploadRemove:function(e,i){if(e.url){var t=this.imgUploadList.findIndex((function(i){return i.url===e.url}));-1!=t&&this.imgUploadList.splice(t,1)}},imgDetailRemove:function(e,i){var t=this,l=this.imgDetailFileList.findIndex((function(i){return i.url===e.url}));-1!=l&&(e.id?p(e.id).then((function(e){200===e.code&&t.imgDetailFileList.splice(l,1)})):this.imgDetailFileList.splice(l,1))},imgHandleExceed:function(){this.$modal.msgError("上传文件数量不能超过 ".concat(this.limit," 个!"))},imgHandleUploadSuccess:function(e,i){200===e.code?(this.imgUploadList.push({name:e.newFileName,url:e.url}),this.$modal.closeLoading()):(this.number--,this.$modal.closeLoading(),this.$modal.msgError(e.msg),this.$refs.imgUploadList.handleRemove(i))},imgDetailHandleUploadSuccess:function(e,i){console.log(e,i),200===e.code?(this.imgDetailFileList.push({name:e.newFileName,url:e.url}),this.$modal.closeLoading()):(this.$modal.closeLoading(),this.$modal.msgError(e.msg),this.$refs.imgUpload.handleRemove(i))},imgHandleUploadError:function(){this.$modal.msgError("上传图片失败，请重试"),this.$modal.closeLoading()},handlePictureCardPreview:function(e){this.dialogImageUrl=this.baseUrl+e.url,this.dialogVisible=!0},handleDetailPictureCardPreview:function(e){this.dialogDetailImageUrl=e.url,this.dialogDetailVisible=!0}}},g=h,b=t("2877"),v=Object(b["a"])(g,l,a,!1,null,null,null);i["default"]=v.exports}}]);